{% extends "base.html" %}

{% load wagtailcore_tags wagtailimages_tags account %}

{% load basket_tags %}
{% load longclawcheckout_tags longclawcore_tags %}

{% block content%}

<div class="container">
    {% for item in basket %}
    <div class="card mb-3" style="max-width: 540px;">
        <div class="row no-gutters">
            <div class="col-md-4 d-block mx-auto">
                {% for img in item.variant.product.first_image %}
                {% if img.caption == item.variant.ref %}
                {% image img.image fill-150x150 %}
                {% endif %}
                {% endfor %}
            </div>
            <div class="col-md-8">
                <div class="card-body">
                    <h5 class="card-title">{{ item.variant.ref }}</h5>
                    <p class="card-text"></p>
                    <button href="" class="delcart" data-quantity="{{item.quantity}}"
                            data-variant="{{item.variant.id}}">Minus
                    </button>
                    <span class="card-text"><small class="text-muted">{{ item.quantity }}</small></span>
                    <button href="" class="addcart" data-quantity="{{item.quantity}}"
                            data-variant="{{item.variant.id}}">add
                    </button>
                    <p class="card-text"><small class="text-muted">{{ item.variant.price }}</small></p>

                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% if basket.count == 0 %}
        <p>Your basket is empty</p>
    {% else %}
        <span>Sub-total({{basket.count}}):{{total_price}}</span>
    {% endif %}
</div>


<!--<div id="basket_items">
    {% for item in basket %}
    <p id="basket-item-count">{{ item.quantity }}</p>
    {{ item.variant.price }}
    {{ item.variant.ref }}

    {% for img in item.variant.product.first_image %}
    {% if img.caption == item.variant.ref %}
    {% image img.image fill-100x100 %}
    {% endif %}
    {% endfor %}


    {{ item.variant.stock }}
    {{ item.variant.ref }}
    {{ item.variant.product.description }}
    {{ item.variant.id}}
    <button href="" class="delcart" data-quantity="{{item.quantity}}"
            data-variant="{{item.variant.id}}">Minus
    </button>
    <button href="" class="addcart" data-quantity="{{item.quantity}}"
            data-variant="{{item.variant.id}}">add
    </button>
</div>

<br>
{% endfor %}-->

{% if not user.is_authenticated %}
<a href="{% url 'account_signup' %}">Sign-up</a>
{% endif %}

<a href="{% url 'longclaw_checkout_view' %}">Checkout</a>
<a href="/">Products</a>


{% longclaw_vendors_bundle %}
{% longclaw_client_bundle %}


{% endblock%}

{% block extra_js %}
        
        
<script type="text/javascript">





    $(".delcart").on('click', function (event) {
        event.preventDefault();
        var variant = event.currentTarget.dataset.variant;
        longclawclient.basketDetail.del({
            prefix: '{% longclaw_api_url_prefix %}',
            urlParams: {
                id: variant,
                quantity: event.currentTarget.dataset.quantity
            }
        }).then(function(response){
            if (response.status == 200){
                location.reload();
            }
        });

    });

    $(".addcart").on('click', function (event) {
        event.preventDefault();
        var variant = event.currentTarget.dataset.variant;
        longclawclient.basketList.post({
            prefix: '{% longclaw_api_url_prefix %}',
            data: {
                variant_id: variant
            }
        }).then(function (response){
            if (response.status == 201){
                location.reload();
            }
        });

    });



</script>

{% endblock %}

