{% extends "base.html" %}

{% load wagtailcore_tags wagtailimages_tags account %}

{% load basket_tags %}
{% load longclawcheckout_tags longclawcore_tags %}

{% block content%}

<div id="basket_items">
    {% for item in basket %}
    <p id="basket-item-count">{{ item.quantity }}</p>
    {{ item.variant.price }}
    {{ item.variant.stock }}
    {{ item.variant.ref }}
    {{ item.variant.product.title }}
    {{ item.variant.product.description }}
    {{ item.variant.id}}
    <button href="" class="delcart" data-quantity="{{item.quantity}}"
            data-variant="{{item.variant.id}}">Minus
    </button>
    <button href="" class="addcart" data-quantity="{{item.quantity}}"
            data-variant="{{item.variant.id}}">add
    </button>
</div>

<br>
{% endfor %}

{% if not user.is_authenticated %}
<a href="{% url 'account_signup' %}">Sign-up</a>
{% endif %}

<a href="{% url 'longclaw_checkout_view' %}">Checkout</a>
<a href="/">Products</a>


{% longclaw_vendors_bundle %}
{% longclaw_client_bundle %}


{% endblock%}

{% block extra_js %}
        
        
<script type="text/javascript">





    $(".delcart").on('click', function (event) {
        event.preventDefault();
        var variant = event.currentTarget.dataset.variant;
        longclawclient.basketDetail.del({
            prefix: '{% longclaw_api_url_prefix %}',
            urlParams: {
                id: variant,
                quantity: event.currentTarget.dataset.quantity
            }
        }).then(function(response){
            if (response.status == 200){
                location.reload();
            }
        });

    });

    $(".addcart").on('click', function (event) {
        event.preventDefault();
        var variant = event.currentTarget.dataset.variant;
        longclawclient.basketList.post({
            prefix: '{% longclaw_api_url_prefix %}',
            data: {
                variant_id: variant
            }
        }).then(function (response){
            if (response.status == 201){
                location.reload();
            }
        });

    });


</script>

{% endblock %}

